<div class="container">
  <header>
    <h1><i class="bi bi-book"></i> Book Management</h1>
    <div class="header-controls">
              <a class="add-btn" [routerLink]="['/categories']">Go Back To Categories</a>

      <button class="add-btn" (click)="openAddModal()">
       <i class="bi bi-plus-circle"></i> Add New Book
      </button>
    </div>
  </header>

  <table class="category-table">
    <thead>
      <tr>
        <th>ID</th>
        <th>Title</th>
        <th>Author</th>
        <th>Published On</th>
        <th>Categories</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let b of books">
        <td class="id-cell">{{ b.bookId }}</td>
        <td>{{ b.title }}</td>
        <td>{{ b.author }}</td>
        <td>{{ b.publishedOn | date }}</td>
        <td>
          <span *ngFor="let c of b.categories; let i = index">
            {{ c }}<span *ngIf="i < b.categories.length - 1">, </span>
          </span>
        </td>
        <td class="actions">
          <button class="edit-btn" (click)="openEditModal(b)">
           <i class="bi bi-pencil-square"></i> Edit
          </button>
          <button class="delete-btn" (click)="openDeleteModal(b)">
           <i class="bi bi-trash"></i> Delete
          </button>
        </td>
      </tr>
      <tr *ngIf="books.length === 0">
        <td colspan="6" class="no-categories">No books found. Add your first book!</td>
      </tr>
    </tbody>
  </table>

  <div class="stats-bar">
    <div class="total">Total: {{ total }} books</div>
  </div>
</div>

<!-- Add/Edit Modal -->
<div class="modal" [ngStyle]="{'display': isModalOpen ? 'flex' : 'none'}">
  <div class="modal-content">
    <h2>{{ modalTitle }}</h2>

    <div class="form-group">
      <label for="bookTitle">Book Title</label>
      <input type="text" id="bookTitle" [(ngModel)]="title" placeholder="Enter book title">
    </div>

    <div class="form-group">
      <label for="author">Author</label>
      <input type="text" id="author" [(ngModel)]="author" placeholder="Enter author name">
    </div>

    <div class="form-group">
      <label for="publishedOn">Published Date</label>
      <input type="date" id="publishedOn" [(ngModel)]="publishedOn">
    </div>

    <div class="form-group">
      <label for="categories">Categories</label>
      <select id="categories" [(ngModel)]="selectedCategoryIds" multiple>
        <option *ngFor="let c of categories" [ngValue]="c.id">{{ c.name }}</option>
      </select>
    </div>

    <div class="modal-actions">
      <button class="cancel-btn" (click)="closeModal()">Cancel</button>
      <button class="confirm-btn" (click)="saveBook()">Save</button>
    </div>
  </div>
</div>

<!-- Delete Modal -->
<div class="modal delete-modal" [ngStyle]="{'display': isDeleteModalOpen ? 'flex' : 'none'}">
  <div class="modal-content">
    <h2>Confirm Deletion</h2>
    <p>
      Are you sure you want to delete "<span>{{ currentBook?.title }}</span>"?
    </p>
    <div class="modal-actions">
      <button class="cancel-btn" (click)="closeDeleteModal()">Cancel</button>
      <button class="confirm-btn" (click)="confirmDelete()">Delete</button>
    </div>
  </div>
</div>
